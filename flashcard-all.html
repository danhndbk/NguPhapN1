<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>N1 Grammar Flashcard - Táº¥t cáº£</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      touch-action: manipulation;  /* ğŸ‘ˆ thÃªm dÃ²ng nÃ y */
    }
    body {
      overscroll-behavior: none;
      touch-action: pan-y;
    }
    .flip-card { 
      perspective: 1000px;
      -webkit-perspective: 1000px;
    }
    .flip-card-inner { 
      transition: transform 0.6s;
      transform-style: preserve-3d;
      -webkit-transform-style: preserve-3d;
    }
    .flip-card.flipped .flip-card-inner { 
      transform: rotateY(180deg);
      -webkit-transform: rotateY(180deg);
    }
    .flip-card-front, .flip-card-back { 
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }
    .flip-card-back { 
      transform: rotateY(180deg);
      -webkit-transform: rotateY(180deg);
    }
    button {
      -webkit-appearance: none;
      appearance: none;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-900 to-purple-900 p-4">
  <div id="app"></div>

  <script src="n1-grammar-data.js"></script>
  <script>
    // Táº£i dá»¯ liá»‡u tá»« file riÃªng hoáº·c Ä‘á»‹nh nghÄ©a á»Ÿ Ä‘Ã¢y
    const allData = [
      ...Array.from({length: 25}, (_, i) => ({id: i+1, part: '1a'})),
      ...Array.from({length: 25}, (_, i) => ({id: i+26, part: '1b'})),
      ...Array.from({length: 22}, (_, i) => ({id: i+51, part: '1c'})),
      ...Array.from({length: 35}, (_, i) => ({id: i+73, part: '1d'}))
    ];

    let mastered = [];
    let idx = 0;
    let tab = 'all';
    let flipped = false;

    function loadAllMastered() {
      mastered = [];
      ['1a', '1b', '1c', '1d'].forEach(part => {
        const partMastered = JSON.parse(localStorage.getItem(`n1_mastered_${part}`) || '[]');
        mastered = [...mastered, ...partMastered];
      });
    }

    function saveMastered(id) {
      // XÃ¡c Ä‘á»‹nh card thuá»™c pháº§n nÃ o
      let part = '';
      if (id <= 25) part = '1a';
      else if (id <= 50) part = '1b';
      else if (id <= 72) part = '1c';
      else part = '1d';

      const partMastered = JSON.parse(localStorage.getItem(`n1_mastered_${part}`) || '[]');
      if (mastered.includes(id)) {
        const newMastered = partMastered.filter(x => x !== id);
        localStorage.setItem(`n1_mastered_${part}`, JSON.stringify(newMastered));
      } else {
        partMastered.push(id);
        localStorage.setItem(`n1_mastered_${part}`, JSON.stringify(partMastered));
      }
      loadAllMastered();
    }

    function getCards() {
      if (tab === 'all') return allData;
      if (tab === 'learning') return allData.filter(c => !mastered.includes(c.id));
      return allData.filter(c => mastered.includes(c.id));
    }

    function render() {
      const cards = getCards();
      const card = cards[idx] || null;
      const app = document.getElementById('app');
      
      app.innerHTML = `
        <div class="max-w-md mx-auto">
          <div class="flex items-center justify-between mb-4">
            <a href="index.html" class="text-white hover:text-yellow-300 transition">â† Menu</a>
            <h1 class="text-white text-2xl font-bold">N1 æ–‡æ³• (1-107)</h1>
            <div class="w-16"></div>
          </div>
          
          <div class="flex justify-center gap-2 mb-4 flex-wrap">
            <button onclick="setTab('all')" class="px-4 py-2 rounded-lg text-sm font-medium transition ${tab === 'all' ? 'bg-yellow-400 text-gray-900' : 'bg-white/20 text-white hover:bg-white/30'}">
              Táº¥t cáº£ (${allData.length})
            </button>
            <button onclick="setTab('learning')" class="px-4 py-2 rounded-lg text-sm font-medium transition ${tab === 'learning' ? 'bg-yellow-400 text-gray-900' : 'bg-white/20 text-white hover:bg-white/30'}">
              ChÆ°a thuá»™c (${allData.length - mastered.length})
            </button>
            <button onclick="setTab('mastered')" class="px-4 py-2 rounded-lg text-sm font-medium transition ${tab === 'mastered' ? 'bg-yellow-400 text-gray-900' : 'bg-white/20 text-white hover:bg-white/30'}">
              ÄÃ£ thuá»™c (${mastered.length})
            </button>
          </div>

          ${cards.length === 0 ? `
            <div class="text-white text-center mt-10 text-lg">KhÃ´ng cÃ³ tháº» nÃ o trong má»¥c nÃ y</div>
          ` : `
            <div class="text-white text-center mb-3 text-lg">${idx + 1} / ${cards.length}</div>
            
            <div class="flip-card h-80 cursor-pointer ${flipped ? 'flipped' : ''}" onclick="flipCard()">
              <div class="flip-card-inner relative w-full h-full">
                <div class="flip-card-front absolute inset-0 bg-white rounded-2xl shadow-2xl flex flex-col items-center justify-center p-6">
                  <div class="text-sm text-gray-400 mb-2">#${card.id}</div>
                  <div class="text-2xl font-bold text-indigo-700 text-center leading-relaxed">Máº«u ${card.id}</div>
                  <div class="text-gray-400 mt-6 text-sm">ğŸ‘† Nháº¥n Ä‘á»ƒ láº­t tháº»</div>
                  <div class="text-xs text-gray-400 mt-2">Pháº§n ${card.part}</div>
                </div>
                <div class="flip-card-back absolute inset-0 bg-gradient-to-br from-yellow-100 to-orange-100 rounded-2xl shadow-2xl p-5 overflow-auto">
                  <div class="text-center text-gray-600">
                    <p class="mb-4">Vui lÃ²ng há»c theo tá»«ng pháº§n Ä‘á»ƒ xem ná»™i dung chi tiáº¿t</p>
                    <p class="text-sm">Máº«u nÃ y thuá»™c <span class="font-bold">Pháº§n ${card.part}</span></p>
                  </div>
                </div>
              </div>
            </div>

            <div class="flex justify-center items-center gap-4 mt-6">
              <button onclick="prev()" class="w-14 h-14 bg-white/20 hover:bg-white/40 rounded-full text-white text-2xl font-bold transition">â†</button>
              <button onclick="toggleMaster(${card.id})" class="px-5 py-3 rounded-lg font-medium transition ${mastered.includes(card.id) ? 'bg-green-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}">
                ${mastered.includes(card.id) ? 'âœ“ ÄÃ£ thuá»™c' : 'â˜ ÄÃ¡nh dáº¥u thuá»™c'}
              </button>
              <button onclick="next()" class="w-14 h-14 bg-white/20 hover:bg-white/40 rounded-full text-white text-2xl font-bold transition">â†’</button>
            </div>
          `}
        </div>
      `;
    }

    function setTab(t) { tab = t; idx = 0; flipped = false; render(); }
    function flipCard() { flipped = !flipped; render(); }
    function next() { const cards = getCards(); flipped = false; idx = (idx + 1) % cards.length; render(); }
    function prev() { const cards = getCards(); flipped = false; idx = (idx - 1 + cards.length) % cards.length; render(); }
    function toggleMaster(id) {
      saveMastered(id);
      render();
    }

    loadAllMastered();
    render();
  </script>
  <!-- <script>
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (event) {
      const now = new Date().getTime();
      if (now - lastTouchEnd <= 300) {
        event.preventDefault();  // cháº·n double tap zoom
      }
      lastTouchEnd = now;
    }, { passive: false });
  </script> -->
</body>
</html>