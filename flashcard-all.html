<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>N1 Grammar Flashcard - Táº¥t cáº£ (1-107)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
	  touch-action: manipulation;  /* ğŸ‘ˆ thÃªm dÃ²ng nÃ y */
    }
    body {
      overscroll-behavior: none;
      touch-action: pan-y;
    }
    .flip-card { 
      perspective: 1000px;
      -webkit-perspective: 1000px;
    }
    .flip-card-inner { 
      transition: transform 0.6s;
      transform-style: preserve-3d;
      -webkit-transform-style: preserve-3d;
    }
    .flip-card.flipped .flip-card-inner { 
      transform: rotateY(180deg);
      -webkit-transform: rotateY(180deg);
    }
    .flip-card-front, .flip-card-back { 
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }
    .flip-card-back { 
      transform: rotateY(180deg);
      -webkit-transform: rotateY(180deg);
    }
    button {
      -webkit-appearance: none;
      appearance: none;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-900 to-purple-900 p-4">
  <div id="app"></div>

  <script>
    // Táº¡o danh sÃ¡ch 107 máº«u vá»›i thÃ´ng tin pháº§n
    const allData = [];
    
    // Pháº§n 1a (1-25)
    for (let i = 1; i <= 25; i++) {
      allData.push({ id: i, part: '1a', partName: 'Pháº§n 1a' });
    }
    
    // Pháº§n 1b (26-50)
    for (let i = 26; i <= 50; i++) {
      allData.push({ id: i, part: '1b', partName: 'Pháº§n 1b' });
    }
    
    // Pháº§n 1c (51-72)
    for (let i = 51; i <= 72; i++) {
      allData.push({ id: i, part: '1c', partName: 'Pháº§n 1c' });
    }
    
    // Pháº§n 1d (73-107)
    for (let i = 73; i <= 107; i++) {
      allData.push({ id: i, part: '1d', partName: 'Pháº§n 1d' });
    }

    let mastered = [];
    let idx = 0;
    let tab = 'all';
    let flipped = false;

    function loadAllMastered() {
      mastered = [];
      ['1a', '1b', '1c', '1d'].forEach(part => {
        try {
          const partMastered = JSON.parse(localStorage.getItem(`n1_mastered_${part}`) || '[]');
          mastered = [...mastered, ...partMastered];
        } catch (e) {
          console.error(`Error loading ${part}:`, e);
        }
      });
    }

    function saveMastered(id) {
      let part = '';
      if (id <= 25) part = '1a';
      else if (id <= 50) part = '1b';
      else if (id <= 72) part = '1c';
      else part = '1d';

      try {
        const partMastered = JSON.parse(localStorage.getItem(`n1_mastered_${part}`) || '[]');
        if (mastered.includes(id)) {
          const newMastered = partMastered.filter(x => x !== id);
          localStorage.setItem(`n1_mastered_${part}`, JSON.stringify(newMastered));
        } else {
          partMastered.push(id);
          localStorage.setItem(`n1_mastered_${part}`, JSON.stringify(partMastered));
        }
        loadAllMastered();
      } catch (e) {
        console.error('Error saving:', e);
      }
    }

    function getCards() {
      if (tab === 'all') return allData;
      if (tab === 'learning') return allData.filter(c => !mastered.includes(c.id));
      return allData.filter(c => mastered.includes(c.id));
    }

    function render() {
      const cards = getCards();
      const card = cards[idx] || null;
      const app = document.getElementById('app');
      
      if (!card) {
        app.innerHTML = `
          <div class="max-w-md mx-auto">
            <div class="flex items-center justify-between mb-4">
              <a href="menu.html" class="text-white hover:text-yellow-300 transition text-lg">â† Menu</a>
              <h1 class="text-white text-xl font-bold">N1 (1-107)</h1>
              <div class="w-16"></div>
            </div>
            <div class="text-white text-center mt-20 text-lg">KhÃ´ng cÃ³ tháº» nÃ o trong má»¥c nÃ y</div>
          </div>
        `;
        return;
      }
      
      app.innerHTML = `
        <div class="max-w-md mx-auto pb-4">
          <div class="flex items-center justify-between mb-4">
            <a href="menu.html" class="text-white hover:text-yellow-300 transition text-lg">â† Menu</a>
            <h1 class="text-white text-xl font-bold">N1 (1-107)</h1>
            <div class="w-16"></div>
          </div>
          
          <div class="flex justify-center gap-2 mb-4 flex-wrap">
            <button id="btn-all" class="px-4 py-2 rounded-lg text-sm font-medium transition ${tab === 'all' ? 'bg-yellow-400 text-gray-900' : 'bg-white/20 text-white'}">
              Táº¥t cáº£ (${allData.length})
            </button>
            <button id="btn-learning" class="px-4 py-2 rounded-lg text-sm font-medium transition ${tab === 'learning' ? 'bg-yellow-400 text-gray-900' : 'bg-white/20 text-white'}">
              ChÆ°a thuá»™c (${allData.length - mastered.length})
            </button>
            <button id="btn-mastered" class="px-4 py-2 rounded-lg text-sm font-medium transition ${tab === 'mastered' ? 'bg-yellow-400 text-gray-900' : 'bg-white/20 text-white'}">
              ÄÃ£ thuá»™c (${mastered.length})
            </button>
          </div>

          <div class="text-white text-center mb-3">
            <div class="text-lg">${idx + 1} / ${cards.length}</div>
            <div class="text-sm text-white/70 mt-1">${card.partName} - Máº«u #${card.id}</div>
          </div>
          
          <div id="flashcard" class="flip-card h-80 cursor-pointer ${flipped ? 'flipped' : ''}">
            <div class="flip-card-inner relative w-full h-full">
              <div class="flip-card-front absolute inset-0 bg-white rounded-2xl shadow-2xl flex flex-col items-center justify-center p-6">
                <div class="text-sm text-gray-400 mb-2">#${card.id}</div>
                <div class="text-2xl font-bold text-indigo-700 text-center leading-relaxed px-2">Máº«u ${card.id}</div>
                <div class="text-gray-400 mt-6 text-sm">ğŸ‘† Nháº¥n Ä‘á»ƒ xem chi tiáº¿t</div>
                <div class="mt-4 px-4 py-2 bg-indigo-100 rounded-lg">
                  <div class="text-xs text-indigo-600">${card.partName}</div>
                </div>
              </div>
              <div class="flip-card-back absolute inset-0 bg-gradient-to-br from-yellow-100 to-orange-100 rounded-2xl shadow-2xl p-5 overflow-auto flex flex-col items-center justify-center">
                <div class="text-center">
                  <div class="text-2xl mb-4">ğŸ“š</div>
                  <div class="text-gray-700 mb-3 font-semibold">Máº«u ngá»¯ phÃ¡p #${card.id}</div>
                  <div class="text-sm text-gray-600 mb-4">Thuá»™c ${card.partName} (Máº«u ${card.id <= 25 ? '1-25' : card.id <= 50 ? '26-50' : card.id <= 72 ? '51-72' : '73-107'})</div>
                  <div class="bg-white/60 rounded-lg p-4 text-left">
                    <p class="text-sm text-gray-700 mb-3">ğŸ’¡ <strong>Gá»£i Ã½:</strong> Äá»ƒ xem chi tiáº¿t máº«u ngá»¯ phÃ¡p nÃ y vá»›i nghÄ©a vÃ  vÃ­ dá»¥ Ä‘áº§y Ä‘á»§, vui lÃ²ng há»c theo tá»«ng pháº§n:</p>
                    <div class="space-y-2 text-xs">
                      <a href="flashcard-1a.html" class="block text-indigo-600 hover:text-indigo-800">â†’ Pháº§n 1a (máº«u 1-25)</a>
                      <a href="flashcard-1b.html" class="block text-blue-600 hover:text-blue-800">â†’ Pháº§n 1b (máº«u 26-50)</a>
                      <a href="flashcard-1c.html" class="block text-green-600 hover:text-green-800">â†’ Pháº§n 1c (máº«u 51-72)</a>
                      <a href="flashcard-1d.html" class="block text-purple-600 hover:text-purple-800">â†’ Pháº§n 1d (máº«u 73-107)</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="flex justify-center items-center gap-3 mt-6">
            <button id="btn-prev" class="w-14 h-14 bg-white/20 hover:bg-white/40 active:bg-white/50 rounded-full text-white text-2xl font-bold transition flex items-center justify-center">â†</button>
            <button id="btn-master" class="px-5 py-3 rounded-lg font-medium transition ${mastered.includes(card.id) ? 'bg-green-500 text-white active:bg-green-600' : 'bg-white text-gray-700 active:bg-gray-200'}">
              ${mastered.includes(card.id) ? 'âœ“ ÄÃ£ thuá»™c' : 'â˜ ÄÃ¡nh dáº¥u thuá»™c'}
            </button>
            <button id="btn-next" class="w-14 h-14 bg-white/20 hover:bg-white/40 active:bg-white/50 rounded-full text-white text-2xl font-bold transition flex items-center justify-center">â†’</button>
          </div>
          
          <div class="mt-6 text-center">
            <a href="index.html" class="text-white/60 text-sm hover:text-white/80">â† Quay vá» Menu Ä‘á»ƒ há»c theo tá»«ng pháº§n</a>
          </div>
        </div>
      `;

      document.getElementById('flashcard').addEventListener('click', flipCard);
      document.getElementById('btn-all').addEventListener('click', () => setTab('all'));
      document.getElementById('btn-learning').addEventListener('click', () => setTab('learning'));
      document.getElementById('btn-mastered').addEventListener('click', () => setTab('mastered'));
      document.getElementById('btn-prev').addEventListener('click', prev);
      document.getElementById('btn-next').addEventListener('click', next);
      document.getElementById('btn-master').addEventListener('click', () => toggleMaster(card.id));
    }

    function setTab(t) { tab = t; idx = 0; flipped = false; render(); }
    function flipCard(e) { e.stopPropagation(); flipped = !flipped; render(); }
    function next() { const cards = getCards(); flipped = false; idx = (idx + 1) % cards.length; render(); }
    function prev() { const cards = getCards(); flipped = false; idx = (idx - 1 + cards.length) % cards.length; render(); }
    function toggleMaster(id) {
      saveMastered(id);
      render();
    }

    loadAllMastered();
    render();
  </script>
</body>
</html>